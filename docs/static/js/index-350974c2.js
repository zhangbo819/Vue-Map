import{R as S,C as E,a as L,b as R}from"./vant@4.6.0_vue@3.2.47-8dfe671f.js";import{Y as G}from"./YearHeader-ba426b62.js";import{M as C,g as A,_ as K}from"./util-55b0f34d.js";import{e as Z,w as g,c as B,r as f,f as l,s as x,t as s,y as T,z as Y,F as V,A as F,x as p,u as m,C as j,D as H}from"./@vue_runtime-core@3.2.47-3f4c49b0.js";import{r as v,u as $}from"./@vue_reactivity@3.2.47-9d7d88d9.js";import{I as b}from"./@vue_shared@3.2.47-19384108.js";import"./@vant_use@1.5.2_vue@3.2.47-02c87728.js";import"./index-0c0db393.js";import"./@vue_runtime-dom@3.2.47-0c0c6f75.js";import"./vue-router@4.2.2_vue@3.2.47-f5537a5c.js";function W(i,y,h){return h?i.localeCompare(y):y.localeCompare(i)}function z(i){return(y,h,u)=>W(y[i],h[i],u)}const q=i=>(j("data-v-a09d8e92"),i=i(),H(),i),J={class:"radios"},O=q(()=>x("p",null,[x("i",null,"单位: 百万美元")],-1)),P=Z({__name:"index",setup(i){const y=[{title:"排名",key:"index",sort:!0},{title:"名次",key:"compare_index",sort:!0,sortFormatter:t=>t.replace(/ \((.+?)\)/,"")},{title:"简称",key:"simpleName"},{title:"名称",key:"name"},{title:"行业",key:"industry",sort:!0,sortFn:z("industry")},{title:"国家",key:"country",sort:!0,sortFn:z("country")},{title:"营收",key:"revenue",sort:!0,sortFormatter:t=>t.replace(",","")},{title:"净利润",key:"profit",sort:!0,sortFormatter:t=>t.replace(",","")},{title:"利润率",key:"profitMargin",sort:!0,sortFormatter:t=>t.replace("%","")}];function h(t){return t.map(e=>y.find(n=>n.key===e))}const u={country:"1",industry:"2",index:"3"},d=v(new Date().getFullYear()),w=v([2020,2021,2022,2023]),r=v({layout:["index","simpleName","industry"],type:u.country,isAll:"0",compare:"0"}),I=v([...y]),_=v([]);g(()=>d.value,async()=>{const t=await A(d.value)||[];t.forEach(e=>{e.simpleName=e.name.replace(/(集团)?(有限公司|股份有限公司|控股有限公司|有限责任公司|总公司|公司|集团)$/,"");let{revenue:n="0",profit:o="0"}=e;return n&&o&&(n=n.replace(/,/g,""),o=o.replace(/,/g,""),e.profitMargin=(Number(o)/Number(n)*100).toFixed(2)+"%"),e}),_.value=t},{immediate:!0});const D=v([]);g([()=>d.value,()=>_.value],async()=>{const t=_.value.reduce((e,n)=>{const o=e.find(c=>c.name===n.country);return o?o.children.push(n):e.push({name:n.country,count:0,children:[n]}),e},[]).map(e=>(e.count=e.children.length,e)).sort((e,n)=>n.count-e.count);D.value=t});const M=v([]);g(()=>d.value,async()=>{M.value=_.value.reduce((t,e)=>{const n=t.find(o=>o.name===e.industry);return n?n.children.push(e):t.push({name:e.industry,count:1,children:[e]}),t},[]).map(t=>(t.count=t.children.length,t)).sort((t,e)=>e.count-t.count)});const U=B(()=>{let t=[];const{type:e,compare:n}=r.value,o=n==="0"?"index":"compare_index",c=r.value.isAll==="0";switch(e){case u.country:{t=c?[o,"simpleName","industry"]:[o,"simpleName","industry","revenue","profit","profitMargin"];break}case u.industry:case u.index:{t=c?[o,"country","simpleName"]:[o,"simpleName","country","revenue","profit","profitMargin"];break}}return t}),N=B(()=>h(r.value.layout));return g(()=>U.value,t=>{r.value.layout=t}),g(()=>d.value,()=>{r.value.compare="0"},{immediate:!0}),g(()=>r.value.compare,async t=>{if(t==="1"){const e=d.value-1,n=await A(e);_.value.forEach(o=>{if(typeof o.compare_index>"u"){const c=n.find(a=>a.name===o.name);let k;if(c){const a=Number(c.index)-Number(o.index);k=a===0?"-0":a>0?`↑${a}`:`↓${Math.abs(a)}`}else k="新";o.compare_index=`${o.index} (${k})`}})}}),(t,e)=>{const n=L,o=S,c=R,k=E;return p(),f("div",null,[l(G,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),"year-list":w.value},null,8,["modelValue","year-list"]),x("div",J,[l(o,{modelValue:r.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.type=a),direction:"horizontal"},{default:s(()=>[l(n,{name:u.index},{default:s(()=>[m("按排名")]),_:1},8,["name"]),l(n,{name:u.country},{default:s(()=>[m("按国家")]),_:1},8,["name"]),l(n,{name:u.industry},{default:s(()=>[m("按行业")]),_:1},8,["name"])]),_:1},8,["modelValue"]),w.value.includes(d.value-1)?(p(),T(o,{key:0,modelValue:r.value.compare,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.compare=a),direction:"horizontal",style:{"margin-top":"12px"}},{default:s(()=>[l(n,{name:"0"},{default:s(()=>[m("正常")]),_:1}),l(n,{name:"1"},{default:s(()=>[m("与去年对比")]),_:1})]),_:1},8,["modelValue"])):Y("",!0),l(o,{modelValue:r.value.isAll,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.isAll=a),direction:"horizontal",style:{"margin-top":"12px"}},{default:s(()=>[l(n,{name:"0"},{default:s(()=>[m("精简版")]),_:1}),l(n,{name:"1"},{default:s(()=>[m("完整版")]),_:1})]),_:1},8,["modelValue"]),l(k,{modelValue:r.value.layout,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.layout=a),direction:"horizontal",style:{"margin-top":"12px","justify-content":"center"}},{default:s(()=>[(p(!0),f(V,null,F(I.value,a=>(p(),T(c,{key:a.key,name:a.key,disabled:r.value.layout.length===1&&r.value.layout[0]===a.key},{default:s(()=>[m(b(a.title),1)]),_:2},1032,["name","disabled"]))),128))]),_:1},8,["modelValue"]),O]),r.value.type===u.country?(p(!0),f(V,{key:0},F(D.value,a=>(p(),f("div",{key:a.name},[x("h3",null,b(`${a.name} (${a.count}个)`),1),l(C,{class:"simpleTable",config:$(N),data:a.children},null,8,["config","data"])]))),128)):r.value.type===u.industry?(p(!0),f(V,{key:1},F(M.value,a=>(p(),f("div",{key:a.name},[x("h3",null,b(`${a.name} (${a.count}个)`),1),l(C,{class:"simpleTable",config:$(N),data:a.children},null,8,["config","data"])]))),128)):r.value.type===u.index?(p(),f(V,{key:2},[x("h3",null,b(`${d.value}年排名`),1),l(C,{class:"simpleTable",config:$(N),data:_.value},null,8,["config","data"])],64)):Y("",!0)])}}});const se=K(P,[["__scopeId","data-v-a09d8e92"]]);export{se as default};
